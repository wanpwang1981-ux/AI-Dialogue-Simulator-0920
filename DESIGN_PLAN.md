# 系統分析與設計規劃書 (System Analysis & Design Plan)

本檔案記錄了 "AI Debate Club" 專案從創立至今的各版本開發規劃與目標。

---

### **v1.43 - 文件還原與優化**
- **目標**: 還原因解決技術問題而意外被刪除的專案文件，並在架構圖中新增Mermaid流程圖。
- **規劃**:
    1.  重建 `README.md`。
    2.  重建 `DESIGN_PLAN.md` (本文件)。
    3.  重建 `ARCHITECTURE.md` 並新增Mermaid流程圖。
    4.  重建 `CHANGELOG.md`。

---

### **v1.42 - 錯誤修正**
- **目標**: 修正v1.4版本中導致程式無法啟動的 `TypeError` 錯誤。
- **規劃**:
    1.  分析 `app.py` 與 `ui.py` 之間的函式呼叫與定義不匹配問題。
    2.  修正 `ui.py` 中 `AppUI` 類別的 `__init__` 函式簽名，使其能正確接收 `persona_manager_command` 參數。

---

### **v1.4 - 功能擴充**
- **目標**: 建立使用者自訂角色系統，並提供「對話風格指令」功能。
- **規劃**:
    1.  **角色管理系統**:
        - 建立新的UI視窗 (`PersonaManagerWindow`, `PersonaEditorWindow`)。
        - 建立 `persona_manager.py` 模組，使用 `user_personas.json` 檔案來儲存、讀取、修改、刪除使用者自訂的角色。
        - 整合至主程式，讓自訂角色出現在下拉選單中。
    2.  **對話風格指令**:
        - 在UI上新增一個文字輸入框。
        - 修改 `app.py` 的對話邏輯，將此指令附加到雙方AI的提示詞中。

---

### **v1.2x - 迭代修正與優化**
- **v1.24**: 修正了對話開頭的「角色介紹」區塊沒有被儲存到檔案的Bug。
- **v1.23**: 優化了輸出日誌的格式，使其更具可讀性；並將儲存按鈕的名稱改為更通用的「儲存對話紀錄」。
- **v1.22**: 新增了Word(.docx)和Excel(.xlsx)的存檔格式；修正了切換模型來源時可能導致的UI卡頓問題。
- **v1.21**: 修正了因選單綁定錯誤導致的啟動Bug；優化了API Key的輸入流程，改為在需要時才提示。

---

### **v1.2 - 支援外部API**
- **目標**: 整合Google Gemini API，並擴充儲存格式。
- **規劃**:
    1.  建立 `gemini_client.py` 模組。
    2.  在UI中新增API金鑰管理介面和模型來源選擇器。
    3.  修改 `app.py` 以支援Ollama和Gemini之間的邏輯切換。
    4.  建立 `output_formatter.py` 並新增對CSV和Markdown格式的支援。

---

### **v1.0 & v1.1 - 基礎建立與初步優化**
- **目標**: 建立一個只支援本地Ollama模型的最小可行產品(MVP)，並進行初步優化。
- **規劃**:
    1.  **v1.0**:
        - 設計並建立模組化架構 (`app.py`, `ui.py`, `ollama_client.py`)。
        - 實現Ollama模型間的對話。
        - 建立核心UI介面。
        - 支援`.txt`格式存檔。
    2.  **v1.1 & v1.11**:
        - 將角色文件翻譯為繁體中文。
        - 實現預設角色自動載入。
        - 優化存檔檔名。
        - 將角色選擇方式從手動輸入改為下拉式選單。
        - 在提示詞中加入強制使用繁體中文的指令。
